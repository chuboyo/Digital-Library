{% extends "base.html" %}

{% load i18n %}

{% load static %}

{% load custom_tags %}

{% block head_title %}{% trans "Recycled Files View" %}{% endblock %}

{% block content %}
 <nav class="nav">
                <div class="container text-center">
                    <div class="row" id="navrow">
                        <div class="col-sm-5">
                            <ul class="nav justify-content-start">
                                <li class="nav-item">
                                    <button type="button" id="sidebarCollapse" class="btn">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="green" class="bi bi-arrow-left-right" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd" d="M1 11.5a.5.5 0 0 0 .5.5h11.793l-3.147 3.146a.5.5 0 0 0 .708.708l4-4a.5.5 0 0 0 0-.708l-4-4a.5.5 0 0 0-.708.708L13.293 11H1.5a.5.5 0 0 0-.5.5zm14-7a.5.5 0 0 1-.5.5H2.707l3.147 3.146a.5.5 0 1 1-.708.708l-4-4a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 4H14.5a.5.5 0 0 1 .5.5z"/>
                                        </svg>
                                    </button>
                                </li>
                            </ul>
                        </div>
                        <div class="col-sm-5">
                           
                        </div>
                        <div class="col-sm-2">
                            <ul class="nav">
                                <li class="nav-item">
                                    <!-- <a class="nav-link active" aria-current="page" href="#"><img src="{% static 'images/bell-icon.png' %}" alt=""></a> -->
                                    {% show_notifications %}
                                </li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <li class="nav-item">
                                    {% if request.user.profile_picture %}
                                    <div class="dropdown">
                                      <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" aria-expanded="false" id="recolorDropdown"><img src="{{ request.user.profile_picture.url }}" alt="..." width="30" height="30" class="rounded-circle">&nbsp;&nbsp;&nbsp;&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="green" class="bi bi-caret-down-fill" viewBox="0 0 16 16">
                                        <path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
                                      </svg></a>

                                      <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="{% url 'user_edit' request.user.id %}" id="dropdownLink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 16">
                                          <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3Zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/>
                                        </svg>&nbsp;&nbsp;&nbsp;&nbsp;Edit profile</a></li>
                                        <li><a class="dropdown-item" href="{% url 'account_change_password' %}" id="dropdownLink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-fill" viewBox="0 0 16 16">
                                          <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"/>
                                        </svg>&nbsp;&nbsp;&nbsp;&nbsp;Change password</a></li>
                                        <li><a class="dropdown-item" href="#" id="dropdownLink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bell-fill" viewBox="0 0 16 16">
                                          <path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2zm.995-14.901a1 1 0 1 0-1.99 0A5.002 5.002 0 0 0 3 6c0 1.098-.5 6-2 7h14c-1.5-1-2-5.902-2-7 0-2.42-1.72-4.44-4.005-4.901z"/>
                                        </svg>&nbsp;&nbsp;&nbsp;&nbsp;Notifications</a></li>
                                        <li><a class="dropdown-item" href="{% url 'account_logout' %}" id="dropdownLink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-power" viewBox="0 0 16 16">
                                          <path d="M7.5 1v7h1V1h-1z"/>
                                          <path d="M3 8.812a4.999 4.999 0 0 1 2.578-4.375l-.485-.874A6 6 0 1 0 11 3.616l-.501.865A5 5 0 1 1 3 8.812z"/>
                                      </svg>&nbsp;&nbsp;&nbsp;&nbsp;Logout</a></li>
                                      </ul>
                                    </div> 
                                    {% else %}
                                    <div class="dropdown">
                                      <a class="nav-link" href="#" data-bs-toggle="dropdown" aria-expanded="false" id="recolorDropdown"><img src="{% static 'images/empty-profile.png' %}" alt="hugenerd" width="30" height="30" class="rounded-circle">&nbsp;&nbsp;&nbsp;&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="green" class="bi bi-caret-down-fill" viewBox="0 0 16 16">
                                        <path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
                                      </svg></a>

                                      <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="{% url 'user_edit' request.user.id %}" id="dropdownLink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-fill" viewBox="0 0 16 16">
                                          <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3Zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/>
                                        </svg>&nbsp;&nbsp;&nbsp;&nbsp;Edit profile</a></li>
                                        <li><a class="dropdown-item" href="{% url 'account_change_password' %}" id="dropdownLink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-fill" viewBox="0 0 16 16">
                                          <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"/>
                                        </svg>&nbsp;&nbsp;&nbsp;&nbsp;Change password</a></li>
                                        <li><a class="dropdown-item" href="#" id="dropdownLink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bell-fill" viewBox="0 0 16 16">
                                          <path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2zm.995-14.901a1 1 0 1 0-1.99 0A5.002 5.002 0 0 0 3 6c0 1.098-.5 6-2 7h14c-1.5-1-2-5.902-2-7 0-2.42-1.72-4.44-4.005-4.901z"/>
                                        </svg>&nbsp;&nbsp;&nbsp;&nbsp;Notifications</a></li>
                                        <li><a class="dropdown-item" href="{% url 'account_logout' %}" id="dropdownLink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-power" viewBox="0 0 16 16">
                                          <path d="M7.5 1v7h1V1h-1z"/>
                                          <path d="M3 8.812a4.999 4.999 0 0 1 2.578-4.375l-.485-.874A6 6 0 1 0 11 3.616l-.501.865A5 5 0 1 1 3 8.812z"/>
                                        </svg>&nbsp;&nbsp;&nbsp;&nbsp;Logout</a></li>
                                      </ul>
                                    </div>
                                    {% endif %} 
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </nav>

<div class="container text-start" id="behave">
    <div class="row">
      <div class="col-12">
        <h4>Recycled Files</h4>
      </div>
    </div>
</div>

<div class="container text-start mb-4">
    <div class="row">
      <div class="col-lg-2">
        
      </div>
      <div class="col-lg-4">

      </div>
      <div class="col-lg-2 text-center">
        
      </div>
      <div class="col-lg-2">
        
      </div>
      <div class="col-lg-2">
        
      </div>
    </div>
</div>

<div class="container text-start pt-2" id="">
  <div class="row" id="">
{% if file_list %}
{% for file in file_list %}
  {% if file.recycled %}
          
              <div class="col-lg-2 pt-4">
                  <div class="card">
                      {% if '.docx' in file.filename.url %}
                          <img src="{% static 'images/wordgrid.webp' %}" class="card-img-top" alt="..." height="120">
                      {% elif 'pdf' in file.filename.url %}
                          <img src="{% static 'images/pdfgrid.jpeg' %}" class="card-img-top" alt="..." height="120">
                      {% elif 'xlsx' in file.filename.url %}
                          <img src="{% static 'images/xcelgrid.jpeg' %}" class="card-img-top" alt="..." height="120">
                      {% elif 'pptx' in file.filename.url or 'ppt' in file.filename.url %}
                          <img src="{% static 'images/pptxgrid.jpeg' %}" class="card-img-top" alt="..." height="120">
                      {% elif 'png' in file.filename.url or 'jpg' in file.filename.url or 'jpeg' in file.filename.url %}
                          <img src="{{ file.filename.url }}" class="card-img-top" alt="..." height="120">
                      {% elif 'mkv' in file.filename.url or 'mpeg' in file.filename.url or 'mp4' in file.filename.url or 'mov' in file.filename.url %}
                          <img src="{% static 'images/moviegrid.webp' %}" class="card-img-top" alt="..." height="120">
                      {% else %}
                          <img src="{% static 'images/genericfile.webp' %}" class="card-img-top" alt="..." height="120">
                      {% endif %}
                      <div class="card-body">
                          <div class="row">
                              <div class="col-10">
                                  <a href="{{ file.filename.url }}">{{  file.filename|truncatechars:10 }}</a>
                              </div>
                              <div class="col-2">
                                  <div class="dropdown">
                                      <button class="modalTrigger" href="#" data-bs-toggle="dropdown" aria-expanded="false"  id="iconButton" value="{{ file.id }}"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="grey" class="bi bi-three-dots-vertical" viewBox="0 0 16 16">
                                        <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                                      </svg></button>
                    
                                      <ul class="dropdown-menu">
                                        {% if request.user.is_custom_admin or request.user.user_role == 'manager' or request.user.user_role == 'content_manager' or request.user.user_role == 'contributor' %}
                                        <li><a type="button" class="dropdown-item modal-button6" id="dropdownLink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-counterclockwise" viewBox="0 0 16 16">
                                          <path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"/>
                                          <path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"/>
                                        </svg>&nbsp;&nbsp;&nbsp;&nbsp;Restore</a></li>
                                        {% else %}
                                        {% endif %}
                                        <!-- <li><a type="button" class="dropdown-item modal-button6" id="dropdownLink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-counterclockwise" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"/>
                                            <path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"/>
                                          </svg>&nbsp;&nbsp;&nbsp;&nbsp;Restore</a></li> -->
                                        {% if request.user.is_custom_admin or request.user.user_role == 'manager' %}
                                        <li><a type="button" class="dropdown-item modal-button7" href="#" id="actionLabel"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-trash3" viewBox="0 0 16 16">
                                          <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"/>
                                        </svg>&nbsp;&nbsp;&nbsp;&nbsp;Delete</a></li>
                                        {% else %}
                                        {% endif %}
                                      </ul>
                                  </div>

                                  <!-- Custom Modal -->
                                  <div id="custom-modal-{{file.filename.id}}" class="modal fade" aria-hidden="true" role="dialog" data-backdrop="static">
                                      <div class="modal-dialog modal-lg wizard-v2-modal-dialog">
                                      <div class="modal-content">
                                          <div class="wizard-v2-menubar jc-space-between">
                                          
                                          <div>
                                          </div>
                                          </div>
                                          <div class="modal-body">
                                              
                                              <p id="nameLabel">Share File &nbsp;&nbsp;&nbsp;&nbsp;{{file.filename|truncatechars:15}}</p>
                                              <input class="form-control user-input" list="datalistOptions" id="user-input-{{file.filename.id}}" placeholder="Add people to share file with" name="userSearch">
                                          <div class="modal-replaceable">
                                              {% include 'filesystem/file_list_result_partial.html' %}
                                          </div>
                                          <div class="appendage">
                                              <div class="container">
                                              <div class="row">
                                                  <div class="col-7">
                                                      <h6>Name(s)</h6>
                                                  </div>
                                                  <div class="col-3">
                                                      <h6>Permissions</h6>
                                                  </div>
                                                  <div class="col-2">
                                                      
                                                  </div>
                                              </div>
                                          </div>
                                          </div>
                                          </div>
                                          <div class="modal-footer">
                                          <div class="pull-right">
                                              <button class="closeModal" id="iconButton">Cancel</button>
                                              <input type='button' class='btn btn-finish btn-fill btn-primary btn-wd shareSubmit' id="loginButton" name='finish' value='Send' />
                                          </div>
                                          
                                          </div>
                                      </div>
                                      </div>
                                  </div>

                                  <!-- Custom Modal2 -->
                                  <div id="custom-modal2-{{file.filename.id}}" class="modal fade" aria-hidden="true" role="dialog" data-backdrop="static">
                                      <div class="modal-dialog modal-lg wizard-v2-modal-dialog">
                                      <div class="modal-content">
                                          <div class="wizard-v2-menubar jc-space-between">
                                          </div>
                                          <div class="modal-body">
                                              
                                              <p id="nameLabel">Rename file </p>
                                              <input class="form-control" list="datalistOptions" id="renameInput-{{file.filename.id}}" placeholder="" name="">    
                                  
                                          </div>
                                          <div class="modal-footer">
                                          <div class="pull-right">
                                              <button class="closeModal2" id="iconButton">Cancel</button>
                                              <input type='button' class='btn btn-finish btn-fill btn-primary btn-wd renameSubmit' id="loginButton" name='finish' value='Send' />
                                          </div>
                                          
                                          </div>
                                      </div>
                                      </div>
                                  </div>

                                  <!-- Custom Modal3 -->
                                  <div id="custom-modal3-{{file.filename.id}}" class="modal fade" aria-hidden="true" role="dialog" data-backdrop="static">
                                      <div class="modal-dialog modal-lg wizard-v2-modal-dialog">
                                      <div class="modal-content">
                                          <div class="wizard-v2-menubar jc-space-between">
                                          
                                          <div>
                                          </div>
                                          </div>
                                          <div class="modal-body">
                                              
                                              <p id="nameLabel">Edit permissions &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{file.filename|truncatechars:10}}</p>
                                              <select class="form-select permissionSelect" aria-label="Default select example" id="permissionSelect-{{file.filename.id}}">
                                              <option selected>All</option>
                                              <option>View</option>
                                              </select>
                                          
                                              
                                  
                                          </div>
                                          <div class="modal-footer">
                                          <div class="pull-right">
                                              <button class="closeModal3" id="iconButton">Cancel</button>
                                              <input type='button' class='btn btn-finish btn-fill btn-primary btn-wd editPermissionSubmit' id="loginButton" name='finish' value='Send' />
                                          </div>
                                          
                                          </div>
                                      </div>
                                      </div>
                                  </div>

                                  <!-- Custom Modal 4-->
                                  <div id="custom-modal4-{{file.filename.id}}" class="modal fade" aria-hidden="true" role="dialog" data-backdrop="static">
                                      <div class="modal-dialog modal-lg wizard-v2-modal-dialog">
                                      <div class="modal-content">
                                          <div class="wizard-v2-menubar2 jc-space-between">
                                          
                                          <div>
                                          </div>
                                          </div>
                                          <div class="modal-body">
                                              
                                              <p id="nameLabel"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-exclamation-circle" viewBox="0 0 16 16">
                                              <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                              <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"/>
                                              </svg>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Move to recycle bin</p>
                                              <p>Are you sure you want to move to recycle bin? The file will still persist in the recycle bin!</p>
                                          
                                              
                                  
                                          </div>
                                          <div class="modal-footer">
                                          <div class="pull-right">
                                              <button class="closeModal4" id="iconButton">Cancel</button>
                                              <input type='button' class='btn btn-finish btn-fill btn-primary btn-wd recycleSubmit' id="deletePic" name='' value='Move file' />
                                          </div>
                                          
                                          </div>
                                      </div>
                                      </div>
                                  </div>

                                                 <!-- Custom Modal8 -->
                                  <div id="custom-modal8-{{file.filename.id}}" class="modal fade" aria-hidden="true" role="dialog" data-backdrop="static">
                                    <div class="modal-dialog modal-lg wizard-v2-modal-dialog">
                                      <div class="modal-content">
                                        <div class="wizard-v2-menubar2 jc-space-between">
                                          
                                          <div>
                                          </div>
                                        </div>
                                        <div class="modal-body">
                                            
                                            <p id="nameLabel">Delete Users on {{file.filename|truncatechars:15}}</p>
                                            <p>Click on the 'X' icon to delete user</p>
                                            <div class="container">
                                              <div class="row">
                                                  <div class="col-7">
                                                      <h6>Name(s)</h6>
                                                  </div>
                                                  <div class="col-3">
                                                      <h6>Permissions</h6>
                                                  </div>
                                                  <div class="col-2">
                                                      
                                                  </div>
                                              </div>
                                            </div>
                                          <div class="modal-replaceable2">
                                            {% include 'filesystem/shared_user_list_result_partial.html' %}
                                          </div>
                                          <div class="appendage">
                                          
                                          </div>
                                        </div>
                                        <div class="modal-footer">
                                          <div class="pull-right">
                                            <button class="closeModal8" id="iconButton">Cancel</button>
                                          </div>
                                          
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                              </div>
                          </div>
                          <div class="row">
                            <div class="col-3" style="height: 25px">
                              {% for shared in file.sharedfiles_set.all %}
                                  {% ifchanged shared.filename.filename.url %}
                                      <span class="badge rounded-pill text-bg-success" id="pillButtonCustomInactive">SHARED</span>
                                  {% endifchanged %}
                              {% endfor %}
                          </div>
                          </div>
                      </div>
                  </div>
              </div>
          
  {% endif %}
{% endfor %}
{% endif %}

{% if private_file_list %}
{% for file in private_file_list %}
  {% if file.recycled  %}
          
              <div class="col-lg-2 pt-4">
                  <div class="card">
                      {% if '.docx' in file.filename.url %}
                          <img src="{% static 'images/wordgrid.webp' %}" class="card-img-top" alt="..." height="120">
                      {% elif 'pdf' in file.filename.url %}
                          <img src="{% static 'images/pdfgrid.jpeg' %}" class="card-img-top" alt="..." height="120">
                      {% elif 'xlsx' in file.filename.url %}
                          <img src="{% static 'images/xcelgrid.jpeg' %}" class="card-img-top" alt="..." height="120">
                      {% elif 'pptx' in file.filename.url or 'ppt' in file.filename.url %}
                          <img src="{% static 'images/pptxgrid.jpeg' %}" class="card-img-top" alt="..." height="120">
                      {% elif 'png' in file.filename.url or 'jpg' in file.filename.url or 'jpeg' in file.filename.url %}
                          <img src="{{ file.filename.url }}" class="card-img-top" alt="..." height="120">
                      {% elif 'mkv' in file.filename.url or 'mpeg' in file.filename.url or 'mp4' in file.filename.url or 'mov' in file.filename.url %}
                          <img src="{% static 'images/moviegrid.webp' %}" class="card-img-top" alt="..." height="120">
                      {% else %}
                          <img src="{% static 'images/genericfile.webp' %}" class="card-img-top" alt="..." height="120">
                      {% endif %}
                      <div class="card-body">
                          <div class="row">
                              <div class="col-10">
                                  <a href="{{ file.filename.url }}">{{  file.filename|truncatechars:10 }}</a>
                              </div>
                              <div class="col-2">
                                  <div class="dropdown">
                                      <button class="modalTrigger" href="#" data-bs-toggle="dropdown" aria-expanded="false"  id="iconButton" value="{{ file.id }}"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="grey" class="bi bi-three-dots-vertical" viewBox="0 0 16 16">
                                        <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                                      </svg></button>
                    
                                      <ul class="dropdown-menu">
                                        {% if request.user.is_custom_admin or request.user.user_role == 'manager' or request.user.user_role == 'content_manager' or request.user.user_role == 'contributor' %}
                                        <li><a type="button" class="dropdown-item modal-button6" id="dropdownLink"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-counterclockwise" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"/>
                                            <path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"/>
                                          </svg>&nbsp;&nbsp;&nbsp;&nbsp;Restore</a></li>
                                        {% endif %}
                                        {% if request.user.is_custom_admin or request.user.user_role == 'manager' %}
                                        <li><a type="button" class="dropdown-item modal-button7" href="#" id="actionLabel"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-trash3" viewBox="0 0 16 16">
                                          <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"/>
                                        </svg>&nbsp;&nbsp;&nbsp;&nbsp;Delete</a></li>
                                        {% endif %}
                                      </ul>
                                  </div>

                                  <!-- Custom Modal -->
                                  <div id="custom-modal-{{file.filename.id}}" class="modal fade" aria-hidden="true" role="dialog" data-backdrop="static">
                                      <div class="modal-dialog modal-lg wizard-v2-modal-dialog">
                                      <div class="modal-content">
                                          <div class="wizard-v2-menubar jc-space-between">
                                          
                                          <div>
                                          </div>
                                          </div>
                                          <div class="modal-body">
                                              
                                              <p id="nameLabel">Share File &nbsp;&nbsp;&nbsp;&nbsp;{{file.filename.filename|truncatechars:15}}</p>
                                              <input class="form-control" list="datalistOptions" id="user-input-{{file.filename.id}}" placeholder="Add people to share file with" name="userSearch">
                                          <div class="modal-replaceable">
                                              {% include 'filesystem/file_list_result_partial.html' %}
                                          </div>
                                          <div class="appendage">
                                              <div class="container">
                                              <div class="row">
                                                  <div class="col-7">
                                                      <h6>Name(s)</h6>
                                                  </div>
                                                  <div class="col-3">
                                                      <h6>Permissions</h6>
                                                  </div>
                                                  <div class="col-2">
                                                      
                                                  </div>
                                              </div>
                                          </div>
                                          </div>
                                          </div>
                                          <div class="modal-footer">
                                          <div class="pull-right">
                                              <button class="closeModal" id="iconButton">Cancel</button>
                                              <input type='button' class='btn btn-finish btn-fill btn-primary btn-wd shareSubmit' id="loginButton" name='finish' value='Send' />
                                          </div>
                                          
                                          </div>
                                      </div>
                                      </div>
                                  </div>

                                  <!-- Custom Modal2 -->
                                  <div id="custom-modal2-{{file.filename.id}}" class="modal fade" aria-hidden="true" role="dialog" data-backdrop="static">
                                      <div class="modal-dialog modal-lg wizard-v2-modal-dialog">
                                      <div class="modal-content">
                                          <div class="wizard-v2-menubar jc-space-between">
                                          </div>
                                          <div class="modal-body">
                                              
                                              <p id="nameLabel">Rename file</p>
                                              <input class="form-control renameInput" list="datalistOptions" id="renameInput-{{file.filename.id}}" placeholder="" name="">    
                                  
                                          </div>
                                          <div class="modal-footer">
                                          <div class="pull-right">
                                              <button class="closeModal2" id="iconButton">Cancel</button>
                                              <input type='button' class='btn btn-finish btn-fill btn-primary btn-wd renameSubmit' id="loginButton" name='finish' value='Send' />
                                          </div>
                                          
                                          </div>
                                      </div>
                                      </div>
                                  </div>

                                  <!-- Custom Modal3 -->
                                  <div id="custom-modal3-{{file.filename.id}}" class="modal fade" aria-hidden="true" role="dialog" data-backdrop="static">
                                      <div class="modal-dialog modal-lg wizard-v2-modal-dialog">
                                      <div class="modal-content">
                                          <div class="wizard-v2-menubar jc-space-between">
                                          
                                          <div>
                                          </div>
                                          </div>
                                          <div class="modal-body">
                                              
                                              <p id="nameLabel">Edit permissions &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{file.filename|truncatechars:10}}</p>
                                              <select class="form-select permissionSelect" aria-label="Default select example" id="permissionSelect-{{file.filename.id}}">
                                              <option selected>All</option>
                                              <option>View</option>
                                              </select>
                                          
                                              
                                  
                                          </div>
                                          <div class="modal-footer">
                                          <div class="pull-right">
                                              <button class="closeModal3" id="iconButton">Cancel</button>
                                              <input type='button' class='btn btn-finish btn-fill btn-primary btn-wd editPermissionSubmit' id="loginButton" name='finish' value='Send' />
                                          </div>
                                          
                                          </div>
                                      </div>
                                      </div>
                                  </div>

                                  <!-- Custom Modal 4-->
                                  <div id="custom-modal4-{{file.filename.id}}" class="modal fade" aria-hidden="true" role="dialog" data-backdrop="static">
                                      <div class="modal-dialog modal-lg wizard-v2-modal-dialog">
                                      <div class="modal-content">
                                          <div class="wizard-v2-menubar2 jc-space-between">
                                          
                                          <div>
                                          </div>
                                          </div>
                                          <div class="modal-body">
                                              
                                              <p id="nameLabel"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-exclamation-circle" viewBox="0 0 16 16">
                                              <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                              <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"/>
                                              </svg>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Move to recycle bin</p>
                                              <p>Are you sure you want to move to recycle bin? The file will still persist in the recycle bin!</p>
                                          
                                              
                                  
                                          </div>
                                          <div class="modal-footer">
                                          <div class="pull-right">
                                              <button class="closeModal4" id="iconButton">Cancel</button>
                                              <input type='button' class='btn btn-finish btn-fill btn-primary btn-wd recycleSubmit' id="deletePic" name='' value='Move file' />
                                          </div>
                                          
                                          </div>
                                      </div>
                                      </div>
                                  </div>

                                                        <!-- Custom Modal8 -->
                                  <div id="custom-modal8-{{file.filename.id}}" class="modal fade" aria-hidden="true" role="dialog" data-backdrop="static">
                                    <div class="modal-dialog modal-lg wizard-v2-modal-dialog">
                                      <div class="modal-content">
                                        <div class="wizard-v2-menubar2 jc-space-between">
                                          
                                          <div>
                                          </div>
                                        </div>
                                        <div class="modal-body">
                                            
                                            <p id="nameLabel">Delete Users on {{file.filename.filename|truncatechars:15}}</p>
                                            <p>Click on the 'X' icon to delete user</p>
                                            <div class="container">
                                              <div class="row">
                                                  <div class="col-7">
                                                      <h6>Name(s)</h6>
                                                  </div>
                                                  <div class="col-3">
                                                      <h6>Permissions</h6>
                                                  </div>
                                                  <div class="col-2">
                                                      
                                                  </div>
                                              </div>
                                            </div>
                                          <div class="modal-replaceable2">
                                            {% include 'filesystem/shared_user_list_result_partial.html' %}
                                          </div>
                                          <div class="appendage">
                                          
                                          </div>
                                        </div>
                                        <div class="modal-footer">
                                          <div class="pull-right">
                                            <button class="closeModal8" id="iconButton">Cancel</button>
                                          </div>
                                          
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                              </div>
                          </div>
                          <div class="row">
                            <div class="col-3" style="height: 25px">
                              {% for shared in file.sharedprivatefiles_set.all %}
                                  {% ifchanged shared.filename.filename.url %}
                                      <span class="badge rounded-pill text-bg-success" id="pillButtonCustomInactive">SHARED</span>
                                  {% endifchanged %}
                              {% endfor %}
                          </div>
                          </div>
                      </div>
                  </div>
              </div>
          
  {% endif %}
{% endfor %}
{% endif %}
  </div>  
</div>


{% endblock %}

{% block js %}
  <script>
    
    $(document).ready(function() {
        
        // constant and variable declarations
        const user_input = $("#user-input")
        const users_div = $('#modal-replaceable')
        const endpoint = '/home/'
        const delay_by_in_ms = 700
        let myCheckboxes = new Array();
        let myUsers = new Array();
        let myUsersPermissions = new Array();
        let file_id;
        let rename_input;
        let permission_value;
        let selected_files = 0;
        let scheduled_function = false;
        let ajax_call = function (endpoint, request_parameters) {
          
          $.getJSON(endpoint, request_parameters)
          
            .then(response => {
               // fade out the users_div, then:
              users_div.fadeTo('slow', 0).promise().then(() => {
                // replace the HTML contents
                users_div.html(response['html_from_view'])
                // fade-in the div with new contents
                users_div.fadeTo('slow', 1)
                
                // onClick of button to add users, get button value(user id) and push to myUsers array 
                // and get associated user permission to push to myUsersPermissions array
                $('.userModal .clickMe').off().on('click', function () {
                    var $duplicate = $(this).parent().parent().parent()
                    var $clone = $duplicate.clone().appendTo(".appendage")
                    let new_id = $(this).parent().prev().children(':first').attr('id')
                    // replace initial button icon(+ sign) with new icon(cancel sign)
                    $('.appendage').find('i').replaceWith(`<i class="bi bi-x-circle" style="color: red;"></i>`)
                    myUsers.push($(this).val());
                    myUsersPermissions.push($(this).parent().prev().children(':first').val())
                    let index2 = myUsersPermissions.indexOf($(this).parent().prev().children(':first').val())
                    // remember selected permission field value in appendage div 
                    $(`.appendage #${new_id}`).val(myUsersPermissions.at(index2))
                })
              })
            })
            .always(function(){
              
            })
            
        }


        user_input.on('keyup', function () {
          const request_parameters = {
            q: $(this).val() // value of user_input: the HTML element with ID user-input
          }
          // if scheduled_function is NOT false, cancel the execution of the function
          if (scheduled_function) {
            clearTimeout(scheduled_function)
          }

          // setTimeout returns the ID of the function to be executed
          scheduled_function = setTimeout(ajax_call, delay_by_in_ms, endpoint, request_parameters)
        })

        
        // onClick of modalTrigger set file id to button instance value 
        $(".modalTrigger").on("click", function(e) {
            file_id = $(this).val()
        })
      
        // onClick of clickMe button within div with class - 'appendage', remove button value(user id) from
        // myUsers array and associated user permission from myUsersPermission array
            $(document).off().on("click", ".appendage .clickMe", function(e) {
                let index = myUsers.indexOf($(this).val());
                myUsers.splice(index, 1);
                myUsersPermissions.splice(index, 1)
                $(this).parent().parent().parent().remove()
            });
            
            // onClick of shareSubmit button, push checked checkboxes to mychechboxes array and 
            // send ajax request to share files with selected users. Subsequently remove all users
            // in the appendage div and close share modal.
            $(".shareSubmit").on("click", function(e) {
                $(".sample:checkbox:checked").each(function() {
                    myCheckboxes.push($(this).val()); // changed this line
                });

                $.ajax({
                    url:  "{% url 'share_file' %}", 
                    data: {
                    csrfmiddlewaretoken: "{{ csrf_token }}",
                        myCheckboxes: myCheckboxes,
                        myUsers: myUsers,
                        myUsersPermissions: myUsersPermissions, 
                        file_id: file_id
                    },
                    type: "POST",
                    dataType : "json",
                })
                
                // $.ajax().done(), $.ajax().fail(), $ajax().always() are upto you. Add/change accordingly
                .done(function(data) {
                    console.log(data);
                })
                .always(function() {
                    console.log('[Done]');
                    // window.location.reload();
                })

                $('.appendage').html("")
                $("#custom-modal").modal("hide");
            })

            // onClick of renameSubmit, get text input value and send ajax request to rename file.
            // close rename modal subsequently
            $(".renameSubmit").on("click", function(e) {
                rename_input = $('#renameInput').val()

                $.ajax({
                    url:  "{% url 'rename_file' %}", 
                    data: {
                    csrfmiddlewaretoken: "{{ csrf_token }}",
                        file_id: file_id,
                        rename_input: rename_input
                    },
                    type: "POST",
                    dataType : "json",
                })
                
                // $.ajax().done(), $.ajax().fail(), $ajax().always() are upto you. Add/change accordingly
                .done(function(data) {
                    console.log(data);
                })
                .always(function() {
                    console.log('[Done]');
                    // window.location.reload();
                })

                $("#custom-modal2").modal("hide");
            })


            // onClick of editPermissionSubmit, get permission value from select and send ajax request to
            // edit permission. close edit permission modal after operation.
            $(".editPermissionSubmit").on("click", function(e) {
                permission_value = $('.permissionSelect').val()
                console.log(permission_value)

                $.ajax({
                    url:  "{% url 'edit_file_permission' %}", 
                    data: {
                    csrfmiddlewaretoken: "{{ csrf_token }}",
                        file_id: file_id,
                        permission_value: permission_value
                    },
                    type: "POST",
                    dataType : "json",
                })
                
                // $.ajax().done(), $.ajax().fail(), $ajax().always() are upto you. Add/change accordingly
                .done(function(data) {
                    console.log(data);
                })
                .always(function() {
                    console.log('[Done]');
                    // window.location.reload();
                })

                $("#custom-modal3").modal("hide");
            })


            // onClick of recycle submit send ajax request to recycle file instance. 
            // close recycle modal after operation is performed.
            $(".recycleSubmit").on("click", function(e) {

                $.ajax({
                    url:  "{% url 'recycle_file' %}", 
                    data: {
                    csrfmiddlewaretoken: "{{ csrf_token }}",
                        file_id: file_id,
                    },
                    type: "POST",
                    dataType : "json",
                })
                
                // $.ajax().done(), $.ajax().fail(), $ajax().always() are upto you. Add/change accordingly
                .done(function(data) {
                    console.log(data);
                })
                .always(function() {
                    console.log('[Done]');
                    // window.location.reload();
                })

                $("#custom-modal4").modal("hide");
            })


            // onClick of modal-button6 send ajax request to restore recycled file instance. 
            
            $(".modal-button6").on("click", function(e) {

                $.ajax({
                    url:  "{% url 'restore_file' %}", 
                    data: {
                    csrfmiddlewaretoken: "{{ csrf_token }}",
                        file_id: file_id,
                    },
                    type: "POST",
                    dataType : "json",
                })

                // $.ajax().done(), $.ajax().fail(), $ajax().always() are upto you. Add/change accordingly
                .done(function(data) {
                    console.log(data);
                })
                .always(function() {
                    console.log('[Done]');
                    // window.location.reload();
                })
            })


            // onClick of modal-button7 send ajax request to delete recycled file instance. 
            
            $(".modal-button7").on("click", function(e) {

                $.ajax({
                    url:  "{% url 'delete_file' %}", 
                    data: {
                    csrfmiddlewaretoken: "{{ csrf_token }}",
                        file_id: file_id,
                    },
                    type: "POST",
                    dataType : "json",
                })

                // $.ajax().done(), $.ajax().fail(), $ajax().always() are upto you. Add/change accordingly
                .done(function(data) {
                    console.log(data);
                })
                .always(function() {
                    console.log('[Done]');
                    // window.location.reload();
                })
            })


            // onClick of .nameFolderSubmit button trigger submission of form to create folder
            $('.nameFolderSubmit').on('click', function(){
              $('#folderCreateForm').submit()
            })

        // onclick of drop-click get selected <li> from dropdwon and make it text input value of 
        // #sortInput associated with #sortForm, then submit sortForm.
        $('.drop-click').on('click', function(){
          let selected_value = $(this).val()
          $('#sortInput').val(selected_value)
          $('#sortForm').submit()
        })
        
        // collapse side bar 
        $('#sidebarCollapse').on('click', function () {
            $('#sidebar').toggleClass('active');
          });
        
        // Click on hidden file input field with id-uploadFolder onClick of of button with id- folderButton
        $('#fileButton').on('click', function (){
            console.log('file list template')
            $('#uploadFolder').click()
        });
        // Submit form onChange event of file input
        $('#uploadFolder').on('change', function(){
            $('#fileForm').submit()
        })

        // share file modal is shown on click of button with id - modal-button
        $('.modal-button').on('click', function() {
          $("#custom-modal").modal("show");
        });

        // Rename file modal is shown onClick of button with id - modal-button2
        $('.modal-button2').on('click', function() {
          $("#custom-modal2").modal("show");
        });

        // Edit file permissions modal is shown onClick of button with id - modal-button3
        $('.modal-button3').on('click', function() {
          $("#custom-modal3").modal("show");
        });

        // Delete file modal is shown onClick of button with id - modal-button4
        $('.modal-button4').on('click', function() {
          $("#custom-modal4").modal("show");
        });

        // Create folder modal is shown onClick of button with id - modal-button5
        $('.modal-button5').on('click', function() {
          $("#custom-modal5").modal("show");
        });

        // hide share file modal on click of button with id - closeModal
        $('.closeModal').on('click', function() {
          $("#custom-modal").modal("hide");
        });

         // hide rename file modal on click of button with id - closeModal2
         $('.closeModal2').on('click', function() {
          $("#custom-modal2").modal("hide");
        });

         // hide edit file permissions modal on click of button with id - closeModal3
         $('.closeModal3').on('click', function() {
          $("#custom-modal3").modal("hide");
        });

         // hide recycle file modal on click of button with id - closeModal4
         $('.closeModal4').on('click', function() {
          $("#custom-modal4").modal("hide");
        });

        // hide create folder modal on click of button with id - closeModal5
        $('.closeModal5').on('click', function() {
          $("#custom-modal5").modal("hide");
        });

        // change row styling on click/unclick of checkbox
        $(".form-check :checkbox").on('change', function(){
          selected_files = $(".form-check :checkbox:checked").length
          // console.log(selected_files)
          $(".form-check :checkbox:checked").each(function(){
            $(this).parent().parent().parent().parent().css("background-color", "#E7F5EE")
            $(".files-selected").html(`${selected_files} Files selected`);
          })
          $(".form-check :checkbox:not(:checked)").each(function(){
            $(this).parent().parent().parent().parent().css("background-color", "#FFFFFF")
            $(".files-selected").html(`${selected_files} Files selected`);
          })
        })
    });
  </script>
{% endblock js %}